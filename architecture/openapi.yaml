openapi: 3.1.0
info:
  title: Email Specifications
  description: Defines the structure and data requirements for emails sent by the backend
  version: 1.0.0

# Email template provider configuration
x-email-template-providers:
  endpoint: "POST /api/service/emails/render"
  description: "Renders email templates with provided data and returns HTML"
    
# Use vendor extensions for email-specific metadata
x-email-templates:
  forgot-password:
    name: "Forgot Password"
    description: "Email that is sent when a user submits the forgot password form."
    trigger: "user_forgot_password"
    subject: "Reset your password"
    template-id: "forgot-password-v1"

components:
  schemas:
    # Common schemas that can be reused
    Language:
      type: string
      enum: [en, es, fr]
      default: en
      
    Theme:
      type: string
      enum: [default, dark, minimal]
      default: default
      
    # Email-specific schemas (must end with "Email")
    ForgotPasswordEmail:
      type: object
      description: Data required for forgot password email template
      properties:
        subject:
          type: string
          default: "Reset your password"
          example: "Reset your password"
        resetLink:
          type: string
          format: uri
          default: "https://example.com/reset"
          example: "https://example.com/reset?token=abc123"
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
          default: ["en"]
        theme:
          $ref: '#/components/schemas/Theme'
      required:
        - resetLink

paths:
  /api/service/emails/render:
    post:
      summary: Render email template
      description: Renders an email template with provided data and returns HTML
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                template_id:
                  type: string
                  description: Template ID/version identifier
                  example: "forgot-password-v1"
                data:
                  type: object
                  description: Template data
                  additionalProperties: true
                  example:
                    subject: "Reset your password"
                    resetLink: "https://example.com/reset?token=abc123"
                    languages: ["en"]
                    theme: "default"
              required:
                - template_id
            examples:
              forgot-password:
                summary: Forgot Password Email
                value:
                  template_id: "forgot-password-v1"
                  data:
                    subject: "Reset your password"
                    resetLink: "https://example.com/reset?token=abc123"
                    languages: ["en"]
                    theme: "default"
      responses:
        '200':
          description: Successfully rendered email template
          content:
            application/json:
              schema:
                type: object
                properties:
                  html:
                    type: string
                    description: Rendered HTML email content
        '400':
          description: Bad request - validation error or invalid data
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  data:
                    type: object
                    description: Additional error data for validation errors
        '404':
          description: Email template not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: 'Email template "Template Name" not found'